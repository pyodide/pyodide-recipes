From 6748eb2358929e4d25cb2d03ed7f2e3aa6fe8354 Mon Sep 17 00:00:00 2001
From: Oscar Benjamin <oscar.j.benjamin@gmail.com>
Date: Sat, 24 May 2025 21:43:02 +0100
Subject: [PATCH 01/01] maint: bump max Cython version and add pypy wheels

Cython 3.1.0a1 is removed from PyPI for some reason.

---


diff --git a/meson.build b/meson.build
index 4072035..a3963a8 100644
--- a/meson.build
+++ b/meson.build
@@ -14,7 +14,7 @@ project(
 flint_lower = '>=3.0'
 flint_upper = '<3.3'
 cython_lower = '>=3.0.11'
-cython_upper = '<=3.1.0a1'
+cython_upper = '<3.2'
 
 py = import('python').find_installation(pure: false)
 dep_py = py.dependency()
diff --git a/pyproject.toml b/pyproject.toml
index 26d8c84..dd77941 100644
--- a/pyproject.toml
+++ b/pyproject.toml
@@ -28,16 +28,16 @@ content-type = "text/markdown"
 # Minimum build requirements tested in CI need to be kept in sync with the
 # versions in requires below so that they are tested.
 #
-# To support the freethreaded build (CPython 3.13t) the alpha release 3.1.0a1
-# of Cython is needed as a minimum requirement. It is possible that future
-# versions of Cython might still work but typically a Cython release breaks
-# something in the build of python-flint so we pin the exact version here.
+# To support the freethreaded build (CPython 3.13t) version 3.1.0 of Cython is
+# needed as a minimum requirement. It is possible that future versions of
+# Cython might still work but typically a Cython release breaks something in
+# the build of python-flint so we include an upper bound here.
 #
 # Apart from the freethreading build any Cython version from 3.0.11 onwards is
 # fine. It is not possible to have a separate version constraint here for the
 # freethreading build only though.
 #
-requires = ["meson-python>=0.13", "cython==3.1.0a1"]
+requires = ["meson-python >= 0.13", "cython >=3.1,<3.2"]
 build-backend = "mesonpy"
 
 [tool.cython-lint]
@@ -82,7 +82,7 @@ package = "flint"
 [tool.cibuildwheel]
 # requires-python needs to keep in sync with this and also the list of Python
 # versions the wheels are tested against in CI.
-build = "cp311-* cp312-* cp313-* cp313t-*" # pp311-*"
+build = "cp311-* cp312-* cp313-* cp313t-* pp311-*"
 skip = "*-win32 *-manylinux_i686 *-musllinux_*"
 
 # Enable building for free-threaded CPython builds
-- 
2.29.2.windows.2

